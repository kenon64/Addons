# Архитектура Стратегического помощника Dota 2

## Обзор системы

Этот проект создан для помощи людям с ограниченными возможностями, которые испытывают сложности с анализом быстро меняющейся игровой ситуации в Dota 2.

## Ключевое отличие

**ГЛАВНОЕ:** Это **тренер/советчик**, а не **автопилот**:
- ❌ НЕ управляет персонажем
- ❌ НЕ кастует способности
- ❌ НЕ покупает предметы автоматически
- ✅ ДАЕТ рекомендации и советы
- ✅ ОБЪЯСНЯЕТ, почему надо что-то делать
- ✅ ПОМОГАЕТ принимать решения

## Компоненты системы

### 1. **Voice Assistant** (`voice_assistant.py`)
```
Микрофон → Google Speech Recognition → Текст
Текст → pyttsx3 → Голос → Динамики
```
Ответственность:
- Распознавание голоса пользователя (если говорит "помощь!" или другие командные слова)
- Озвучивание рекомендаций и советов тренера

### 2. **Game Analyzer** (`game_integration.py`)
```
Dota 2 процесс → Проверка запущена ли игра
Игровые события → Сбор информации о состоянии
```
Ответственность:
- Контроль запущена ли Dota 2
- Сбор информации о состоянии игры:
  - Позиции героев (своих и врагов)
  - Уровни и опыт
  - Предметы и золото
  - Здоровье и маны
  - Недавние события
- Анализ угроз на карте

**Примечание:** Текущая версия использует примерные данные. В полной версии будет использоваться Dota 2 API или OCR.

### 3. **Qwen Strategist** (`qwen_processor.py`)
```
Состояние игры → Умное промптирование
                    ↓
              Qwen API (алиба облако)
                    ↓
         Рекомендация со стратегией
```
Ответственность:
- Формирование интеллектуального промпта с полной информацией о игре
- Обращение к Qwen AI (через API Alibaba DashScope)
- Парсинг ответа и извлечение рекомендаций
- Указание уровня уверенности

**Промпт включает:**
```
- Текущее время игры
- Информация о героях (свой и враги)
- Состояние здоровья
- Предметы
- Позиции на карте
- Недавние события
```

### 4. **Dota Coach** (`coach.py`)
```
╔─────────────────────────────────────╗
│   DotaCoach (главный координатор)   │
└─────────────────────────────────────┘
         ↓           ↓          ↓
    Voice      Game      Qwen
   Assistant  Analyzer  Strategist
```
Ответственность:
- **Главный цикл:** постоянно снимает данные о игре
- **Анализ:** периодически запрашивает рекомендации у Qwen
- **Кулдаун:** не давать рекомендации чаще, чем каждые 30 сек (чтобы не раздражать)
- **Озвучивание:** преобразует рекомендации в понятный голосовой формат
- **Обработка запросов:** если игрок попросит помощь, дает развернутый анализ

## Поток данных

```
┌─────────────────────────────────────────────────────────────┐
│                   Dota 2 запущена?                          │
└──────────────────────────┬──────────────────────────────────┘
                           │ Да
                           ↓
┌─────────────────────────────────────────────────────────────┐
│       GameAnalyzer.get_current_game_state()                │
│  Получить: позиции, уровни, предметы, события            │
└──────────────────────────┬──────────────────────────────────┘
                           │
                           ↓
┌─────────────────────────────────────────────────────────────┐
│   Прошло достаточно времени для новой рекомендации?        │
│   (cooldown 30 сек)                                         │
└──────────────────────────┬──────────────────────────────────┘
                           │ Да
                           ↓
┌─────────────────────────────────────────────────────────────┐
│    QwenStrategist.analyze_situation(game_state)            │
│    → Отправить данные в Qwen API                          │
│    → Получить рекомендацию                                │
└──────────────────────────┬──────────────────────────────────┘
                           │
                           ↓
┌─────────────────────────────────────────────────────────────┐
│   Coach._voice_report_recommendation(analysis)             │
│    → VoiceAssistant.speak(recommendation)                  │
│    → Озвучить советы игроку через динамики                │
└─────────────────────────────────────────────────────────────┘
```

## Типы рекомендаций

Система генерирует рекомендации по разным направлениям:

| Тип | Пример | Когда |
|-----|--------|-------|
| **Позиционирование** | "Отойди аз назад, враг может прийти" | Когда враг мисс на карте |
| **Фарм** | "На линии спокойно, собери денег на предмет" | Ранняя игра, враг далеко |
| **Объективы** | "Вся команда готова, идите влияться" | Преимущество на карте |
| **Безопасность** | "Осторожнее, враги вокруг" | Опасная позиция |
| **Предметы** | "Сними Treads, возьми Ring of Protection" | Нужно менять бу́льди |

## Конфигурация

**En переменные окружения (.env):**

```
QWEN_API_KEY          # Ключ для API Qwen от Alibaba
QWEN_MODEL            # Модель (qwen-max рекомендуется)  
DOTA2_PROCESS_NAME    # Имя процесса Dota 2
LANGUAGE              # Язык (ru_RU, en_US)
ANALYSIS_INTERVAL     # Интервал анализа (сек)
```

## Установка и запуск

### Требования
```bash
pip install -r requirements.txt
```

### Конфигурация
```bash
cp .env.example .env
# Отредактировать .env и добавить QWEN_API_KEY
```

### Запуск
```bash
python main.py
```

## Взаимодействие пользователя

### Базовое использование
1. Запуск программы
2. Открыть Dota 2
3. Начать игру
4. **Автоматическое рекомендации** каждые 30 сек

### Запрос помощи (будущее)
- Скажите ключевое слово (например, "тренер")
- Система дает развернутый análisis

## Будущие улучшения

1. **Dota 2 API Integration**
   - Получение точных данных из игры в реальном времени
   - Анализ актуальных координат и состояний

2. **OCR для экрана**
   - Парсинг информации прямо с экрана
   - Распознавание героев без API

3. **Machine Learning модели**
   - Обучение на реальных матчах про-игроков
   - Персонализация под роль героя

4. **Интеграция с голосовыми командами**
   - Активация горячей клавишей во время игры
   - Распознавание сложных запросов в игре

5. **Анализ реплеев**
   - Рекомендации после игры
   - Выявление ошибок и улучшений

## Лицензия

MIT

---

**Дополнительные вопросы?** Откройте Issue в репозитории!
